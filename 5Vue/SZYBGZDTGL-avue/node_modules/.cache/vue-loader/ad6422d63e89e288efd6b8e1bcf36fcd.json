{"remainingRequest":"E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\src\\page\\frame\\example\\gridexample\\grid9.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\src\\page\\frame\\example\\gridexample\\grid9.vue","mtime":1658282431698},{"path":"E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\兴才svn平台\\01苏州医保局\\88苏州医保中心岗位职责动态管理系统（SZYBGZDTGL）\\0工程\\5Vue\\SZYBGZDTGL-avue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {BaseCtrl} from '/src/util/eframe'\r\nimport {mapGetters} from \"vuex\";\r\nimport constData from \"../../../../const\";\r\n\r\nexport default {\r\n  name: \"grid9\",\r\n  mixins: [BaseCtrl],\r\n  data() {\r\n    return {\r\n      dialogTableVisible:false,\r\n      visable1: false,\r\n      visable2: false,\r\n      selectTab: 0,\r\n      fixmedins_id: '',\r\n      //中西药查询\r\n      wsForm: {\r\n        med_list_codg: '',//医疗目录编号\r\n        fixmedins_hilist_id: '',//自定义编码\r\n        drug_name: '',//药品名\r\n        pinyin: '',//助记码\r\n        prodentp_name: '',//生产企业名称\r\n        type: '',//医保属性\r\n        spec: '',//药品规格\r\n        list_type: '',//目录类别\r\n        dosformCode: '', //药品剂型\r\n        chk_stas: '', //审核状态\r\n        valid: '1', //有效标志\r\n      },\r\n      //中药饮片查询\r\n      tcForm: {\r\n        dosform: '',\r\n        prodentp_name: '',\r\n        exct_cont: '',\r\n        spec: '',\r\n        med_list_codg: '',//医疗目录编号\r\n        fixmedins_hilist_id: '',//自定义编码\r\n        drug_name: '',//药品名称\r\n        type: '',//医保属性\r\n        // pinyin: '',//拼音助记码\r\n        // wubi: '',//五笔助记码\r\n        tcmherb_year: '',//中草药年份\r\n        cpnd_flag: '',//单复方标志\r\n        ecy_type: '',//功效分类\r\n        efcc_atd: '',//功能主治\r\n        chk_stas: '', //审核状态\r\n        valid: '1', //有效标志\r\n      },\r\n      accept: \"xls,xlsx\",\r\n    }\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    this.visable1 = false\r\n    this.visable2 = false\r\n    next()\r\n  },\r\n  created() {\r\n    let that = this;\r\n    this.loadDicItem({dicId: \"DIC_DRUG_DOSFORM\"});//药品剂型字典\r\n    this.fixmedins_id = that.userInfo.fixmedins_id;\r\n    this.$nextTick(() => {\r\n      //中西药\r\n      this.$refs['medListCrspMgrGrid'].setInitFun((grid) => {//扩展Grid函数\r\n        let options = grid.getOptions();\r\n\r\n        options.dataBound = function () {\r\n          let row = grid.dataSource.data();\r\n          for (let i = 0; i < row.length; i++) {\r\n            let uid = row[i].uid;\r\n            let invalid = row[i].INVALID;\r\n            if (invalid == \"1\") {\r\n              $(\"tbody\").find(\"tr[data-uid=\" + uid + \"]\").css(\"color\", \"red\")\r\n            }\r\n          }\r\n        };\r\n\r\n        let columns = options.columns;\r\n        columns.unshift({\r\n          title: \"操作\",\r\n          width: 62,\r\n          locked:true,\r\n          command: [\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn01\",\r\n              template: \"<a class='k-button k-grid-btn01'>修改</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '1') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail(rowData);\r\n                }\r\n              }\r\n            },\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn02\",\r\n              template: \"<a class='k-button k-grid-btn02'>查看</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '0') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail(rowData);\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        grid.setOptions(options);\r\n        that.loadMedList1();\r\n      });\r\n\r\n      //中药饮片\r\n      this.$refs['medListCrspMgr103Grid'].setInitFun((grid) => {//扩展Grid函数\r\n        let options = grid.getOptions();\r\n\r\n        options.dataBound = function () {\r\n          let row = grid.dataSource.data();\r\n          for (let i = 0; i < row.length; i++) {\r\n            let uid = row[i].uid;\r\n            let invalid = row[i].INVALID;\r\n            if (invalid == \"1\") {\r\n              $(\"tbody\").find(\"tr[data-uid=\" + uid + \"]\").css(\"color\", \"red\")\r\n            }\r\n          }\r\n        };\r\n\r\n        let columns = options.columns;\r\n        columns.unshift({\r\n          title: \"操作\",\r\n          width: 62,\r\n          command: [\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn01\",\r\n              template: \"<a class='k-button k-grid-btn01'>修改</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '1') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail103(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail103(rowData);\r\n                }\r\n              }\r\n            },\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn02\",\r\n              template: \"<a class='k-button k-grid-btn02'>查看</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '0') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail103(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail103(rowData);\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        grid.setOptions(options);\r\n        that.loadMedList2();\r\n      });\r\n    });\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"userInfo\"])\r\n  },\r\n  mounted() {\r\n  },\r\n  methods: {\r\n    //查找国家库中作废的对照\r\n    searchInvalidMed() {\r\n      let whereCondition = \" invalid='1' \";\r\n      let grid = \"medListCrspMgrGrid\";\r\n      if (this.selectTab == 1) {\r\n        this.resetMedList2();\r\n        grid = \"medListCrspMgr103Grid\";\r\n      } else {\r\n        this.resetMedList1();\r\n      }\r\n      this.$refs[grid].getWidget().doRefresh({\r\n        whereCondition: whereCondition,\r\n        parameters: {fixmedins_id: this.fixmedins_id}\r\n      });\r\n    },\r\n\r\n    //药品剂型改变时\r\n    tcDosformChange(val) {\r\n      if (val) {\r\n        //取剂型名称\r\n        this.tcForm.dosform = this.selectDicItem('DIC_DRUG_DOSFORM', val);\r\n      } else {\r\n        this.tcForm.dosform = \"\";\r\n      }\r\n    },\r\n\r\n    changeSelectTab(num) {\r\n      //清空搜索条件\r\n      this.wsForm.dosformCode = \"\";\r\n      this.selectTab = num;\r\n    },\r\n    //打开自费西药页面\r\n    openMedlistcrspmgrowndetail(item) {\r\n      let that = this;\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgrGrid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      that.slideReveal({\r\n        title: \"自费药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrowndetail\",\r\n        width: 1000,\r\n        params: {\r\n          medins_medlist_id: item.get(\"MEDINS_MEDLIST_ID\"),//药品内码\r\n          list_type: item.get(\"LIST_TYPE\")//目录类别\r\n        },\r\n        callBackFun: backFun\r\n      });\r\n\r\n    },\r\n    //打开医保西药页面\r\n    openMedlistcrspmgrdetail(item) {\r\n      let that = this;\r\n      let flag = false;\r\n      let invalid = item.get(\"INVALID\");\r\n      if (invalid == \"1\") {//医保无效——本机构作废\r\n        flag = true;\r\n      }\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgrGrid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      that.slideReveal({\r\n        title: \"医保药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrdetail\",\r\n        width: 1000,\r\n        params: {\r\n          med_list_codg: item.get(\"MED_LIST_CODG\"),//医疗目录编码\r\n          list_type: item.get(\"LIST_TYPE\"),\r\n          medins_medlist_id: item.get(\"MEDINS_MEDLIST_ID\"),//药品内码\r\n          vali_flag: item.get(\"VALI_FLAG\"),//药品无效\r\n          city_code: item.get(\"CITY_CODE\"),//市码\r\n          prov_code: item.get(\"PROV_CODE\"),//省码\r\n          flag: flag\r\n        },\r\n        callBackFun: backFun\r\n      });\r\n    },\r\n\r\n    //打开自费中药饮片页面\r\n    openMedlistcrspmgrowndetail103(item) {\r\n      let that = this;\r\n      let medins_medlist_id = item.get(\"MEDINS_MEDLIST_ID\");//药品内码\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgr103Grid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      that.slideReveal({\r\n        title: \"自费药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrowndetail103\",\r\n        width: 1000,\r\n        params: {medins_medlist_id: medins_medlist_id},\r\n        callBackFun: backFun\r\n      });\r\n    },\r\n    //打开医保中药饮片页面\r\n    openMedlistcrspmgrdetail103(item) {\r\n      let that = this;\r\n      let flag = false;\r\n      let invalid = item.get(\"INVALID\");\r\n      if (invalid == \"1\") {//医保无效——本机构作废\r\n        flag = true;\r\n      }\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgr103Grid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      console.log(item);\r\n      that.slideReveal({\r\n        title: \"医保药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrdetail103\",\r\n        width: 1000,\r\n        params: {\r\n          med_list_codg: item.get(\"MED_LIST_CODG\"),//医疗目录编码\r\n          medins_medlist_id: item.get(\"MEDINS_MEDLIST_ID\"),//药品内码\r\n          vali_flag: item.get(\"VALI_FLAG\"),//药品无效\r\n          city_code: item.get(\"CITY_CODE\"),//市码\r\n          prov_code: item.get(\"PROV_CODE\"),//省码\r\n          flag: flag\r\n        },\r\n        callBackFun: backFun\r\n      });\r\n    },\r\n    loadMedList1() {\r\n      let whereCondition = \"1=1\";\r\n      if (this.wsForm.med_list_codg) {\r\n        whereCondition += \" and (lower(med_list_codg) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(fixmedins_hilist_id) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(city_code) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(fix_asit_code) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(prov_code) like lower('%\" + this.wsForm.med_list_codg + \"%'))\";\r\n      }\r\n      if (this.wsForm.commodity_name) {\r\n        whereCondition += \"and commodity_name like '%\" + this.wsForm.commodity_name + \"%'\";\r\n      }\r\n      if (this.wsForm.drug_name) {\r\n        whereCondition += \"and (fixmedins_hilist_name like '%\" + this.wsForm.drug_name + \"%'\" +\r\n            \" OR drug_genname like '%\" + this.wsForm.drug_name + \"%'\" +\r\n            \" OR commodity_name like '%\" + this.wsForm.drug_name + \"%')\";\r\n      }\r\n      if (this.wsForm.pinyin) {\r\n        whereCondition += \" and (lower(pinyin) like lower('%\" + this.wsForm.pinyin + \"%')\" +\r\n            \" or lower(wubi) like lower('%\" + this.wsForm.pinyin + \"%'))\";\r\n      }\r\n      if (this.wsForm.prodentp_name) {\r\n        whereCondition += \" and prodentp_name like '%\" + this.wsForm.prodentp_name + \"%'\";\r\n      }\r\n      if (this.wsForm.type && this.wsForm.type !== '2') {\r\n        whereCondition += \" and type = '\" + this.wsForm.type + \"'\";\r\n      }\r\n      if (this.wsForm.spec) {\r\n        whereCondition += \" and spec like '%\" + this.wsForm.spec + \"%'\";\r\n      }\r\n      if (this.wsForm.list_type) {\r\n        whereCondition += \" and list_type = '\" + this.wsForm.list_type + \"'\";\r\n      }\r\n      if (this.wsForm.dosformCode) {\r\n        let drug_dosform = this.selectDicItem('DIC_DRUG_DOSFORM', this.wsForm.dosformCode);\r\n        if (this.isNotNull(drug_dosform)) {\r\n          whereCondition += \" and dosform = '\" + drug_dosform + \"'\";\r\n        }\r\n      }\r\n      if (this.wsForm.chk_stas) {\r\n        whereCondition += \" and CHK_STAS = '\" + this.wsForm.chk_stas + \"'\";\r\n      }\r\n      if (this.wsForm.valid) {\r\n        whereCondition += \" and VALI_FLAG = '\" + this.wsForm.valid + \"'\";\r\n      }\r\n      this.$refs['medListCrspMgrGrid'].getWidget().doRefresh({\r\n        whereCondition: whereCondition,\r\n        parameters: {fixmedins_id: this.fixmedins_id}\r\n      });\r\n    },\r\n    resetMedList1() {\r\n      this.wsForm.med_list_codg = '';\r\n      this.wsForm.fixmedins_hilist_id = '';\r\n      this.wsForm.pinyin = '';\r\n      this.wsForm.drug_name = '';\r\n      this.wsForm.prodentp_name = '';\r\n      this.wsForm.type = '';\r\n      this.wsForm.spec = '';\r\n      this.wsForm.list_type = '';\r\n      this.wsForm.dosformCode = '';\r\n      this.wsForm.chk_stas = '';\r\n      this.wsForm.valid = '1';\r\n    },\r\n    loadMedList2() {\r\n      let whereCondition = \"1=1\";\r\n      if (this.tcForm.type && this.tcForm.type !== '2') {\r\n        whereCondition += \" and type = '\" + this.tcForm.type + \"'\";\r\n      }\r\n      if (this.tcForm.med_list_codg) {\r\n        whereCondition += \" and (lower(med_list_codg) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(fixmedins_hilist_id) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(city_code) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(fix_asit_code) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(prov_code) like lower('%\" + this.tcForm.med_list_codg + \"%'))\";\r\n      }\r\n      if (this.tcForm.prodentp_name) {\r\n        whereCondition += \" and prodentp_name like '%\" + this.tcForm.prodentp_name + \"%'\";\r\n      }\r\n      if (this.tcForm.exct_cont) {\r\n        whereCondition += \" and exct_cont like '%\" + this.tcForm.exct_cont + \"%'\";\r\n      }\r\n      if (this.tcForm.spec) {\r\n        whereCondition += \" and spec like '%\" + this.tcForm.spec + \"%'\";\r\n      }\r\n      if (this.tcForm.dosform) {\r\n        whereCondition += \" and dosform = '\" + this.tcForm.dosform + \"'\";\r\n      }\r\n      if (this.tcForm.drug_name) {\r\n        whereCondition += \"and (fixmedins_hilist_name like '%\" + this.tcForm.drug_name + \"%'\" +\r\n            \" or commodity_name like '%\" + this.tcForm.drug_name + \"%')\";\r\n      }\r\n      if (this.tcForm.tcmherb_year) {\r\n        whereCondition += \" and tcmherb_year = '\" + this.tcForm.tcmherb_year + \"'\";\r\n      }\r\n      if (this.tcForm.cpnd_flag) {\r\n        whereCondition += \" and cpnd_flag = '\" + this.tcForm.cpnd_flag + \"'\";\r\n      }\r\n      if (this.tcForm.ecy_type) {\r\n        whereCondition += \" and ecy_type like '%\" + this.tcForm.ecy_type + \"%'\";\r\n      }\r\n      if (this.tcForm.efcc_atd) {\r\n        whereCondition += \" and efcc_atd like '%\" + this.tcForm.efcc_atd + \"%'\";\r\n      }\r\n      if (this.tcForm.chk_stas) {\r\n        whereCondition += \" and CHK_STAS = '\" + this.tcForm.chk_stas + \"'\";\r\n      }\r\n      if (this.tcForm.valid) {\r\n        whereCondition += \" and VALI_FLAG = '\" + this.tcForm.valid + \"'\";\r\n      }\r\n\r\n      this.$refs['medListCrspMgr103Grid'].getWidget().doRefresh({\r\n        whereCondition: whereCondition,\r\n        parameters: {fixmedins_id: this.fixmedins_id}\r\n      });\r\n    },\r\n    resetMedList2() {\r\n      this.tcForm.type = '';\r\n      this.tcForm.med_list_codg = '';\r\n      this.tcForm.fixmedins_hilist_id = '';\r\n      this.tcForm.drug_name = '';\r\n      this.tcForm.tcmherb_year = '';\r\n      this.tcForm.cpnd_flag = '';\r\n      this.tcForm.ecy_type = '';\r\n      this.tcForm.efcc_atd = '';\r\n      this.tcForm.dosformCode = '';\r\n      this.tcForm.dosform = '';\r\n      this.tcForm.prodentp_name = '';\r\n      this.tcForm.exct_cont = '';\r\n      this.tcForm.spec = '';\r\n      this.tcForm.chk_stas = '';\r\n      this.tcForm.valid = '1';\r\n    },\r\n\r\n    doExport() {\r\n      let that = this;\r\n      let okFun = function () {\r\n        if (that.selectTab === 0) {\r\n          that.exportFileByWidget({\r\n            widget: that.$refs['medListCrspMgrGrid'].getWidget(),\r\n            expType: \"all\",\r\n            fileType: \"excel\"\r\n          });\r\n        } else {\r\n          that.exportFileByWidget({\r\n            widget: that.$refs['medListCrspMgr103Grid'].getWidget(),\r\n            expType: \"all\",\r\n            fileType: \"excel\"\r\n          });\r\n        }\r\n      };\r\n      this.confirm(\"提示\", \"确定要导出查询出的药品信息吗？\", okFun, null);\r\n    },\r\n    importFile1(file) {\r\n      let that = this;\r\n      let name = file.name;\r\n      var form = {\r\n        file: file,\r\n      };\r\n      var callBackFun = function (data) {\r\n        if (data != null) {\r\n          if (isNotNull(data.error)) {\r\n            that.$eframe.alertMessage(\"导入失败：\" + data.error);\r\n            return;\r\n          }\r\n          if (isNotNull(data.errorCount) && data.errorCount > 0) {\r\n            window.location.href = constData.baseUrl + \"/download/\" + data.excelName;\r\n            that.$eframe.alertMessage(data.info + \"详细参考：\" + data.excelName);\r\n          } else {\r\n            that.$eframe.alertMessage(\"您本次成功导入\" + data.successCount + \"条记录\");\r\n          }\r\n        }\r\n        that.loadMedList1();\r\n      };\r\n      this.$eframe.submitTargetFileForm({\r\n        url: \"/ehis/medlistmgmt/medlist.action\",\r\n        form: form,\r\n        actionFunName: \"impMedListData\",\r\n        succFun: callBackFun,\r\n        files: file\r\n      });\r\n    },\r\n    importFile2(file) {\r\n      let that = this;\r\n      let name = file.name;\r\n      var form = {\r\n        file: file,\r\n      };\r\n      var callBackFun = function (data) {\r\n        if (data != null) {\r\n          if (isNotNull(data.error)) {\r\n            that.$eframe.alertMessage(\"导入失败：\" + data.error);\r\n            return;\r\n          }\r\n          if (isNotNull(data.errorCount) && data.errorCount > 0) {\r\n            window.location.href = constData.baseUrl + \"/download/\" + data.excelName;\r\n            that.$eframe.alertMessage(data.info + \"详细参考：\" + data.excelName);\r\n          } else {\r\n            that.$eframe.alertMessage(\"您本次成功导入\" + data.successCount + \"条记录\");\r\n          }\r\n        }\r\n        that.loadMedList2();\r\n      };\r\n      this.$eframe.submitTargetFileForm({\r\n        url: \"/ehis/medlistmgmt/medlist.action\",\r\n        form: form,\r\n        actionFunName: \"impHerbListData\",\r\n        succFun: callBackFun,\r\n        files: file\r\n      });\r\n    },\r\n  }\r\n}\r\n",{"version":3,"sources":["grid9.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8OA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"grid9.vue","sourceRoot":"src/page/frame/example/gridexample","sourcesContent":["<template>\r\n  <el-container style=\"height: 100%\">\r\n    <el-header>\r\n      <div class=\"header-left\">\r\n        <div class=\"header-left-tabbar\">\r\n          <div class=\"header-left-tab\" @click=\"changeSelectTab(0)\" :class=\"{'header-left-tab-active':selectTab == 0}\">\r\n            西药中成药\r\n          </div>\r\n          <div class=\"header-left-tab\" @click=\"changeSelectTab(1)\" :class=\"{'header-left-tab-active':selectTab == 1}\">\r\n            中药饮片\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n      <div class=\"header-right\">\r\n        <el-button v-prevent-re-click icon=\"el-icon-plus\" size=\"mini\" type=\"primary\" @click=\"dialogTableVisible = true\">显示源码</el-button>\r\n        <el-popover class=\"exp-info\" style=\"margin-left: 100px\" placement=\"bottom-start\" width=\"250\"\r\n                    trigger=\"hover\">\r\n          <p>红色字体表示该药品已在国家库作废</p>\r\n          <div slot=\"reference\">\r\n            <div class=\"exp-info-content\"><i class=\"el-icon-question\"\r\n                                             style=\"margin-right:5px;\"></i>操作说明\r\n            </div>\r\n          </div>\r\n        </el-popover>\r\n      </div>\r\n      <!--      显示源码-->\r\n      <el-dialog title=\"源码展示\" :visible.sync=\"dialogTableVisible\" :modal-append-to-body=\"false\">\r\n        <iframe src=\"/static/frame/example/gridexample/grid9.html\" frameborder=\"0\"\r\n                style=\"width: 100%;height: 400px\"></iframe>\r\n      </el-dialog>\r\n    </el-header>\r\n    <el-main style=\"height: calc(100% - 37px);overflow: auto;\">\r\n      <div class=\"main-content\" style=\"height: 100%;\">\r\n        <div style=\"height: 100%;\" v-show=\"selectTab == 0\">\r\n          <base-block style=\"height: 100%;box-shadow: 0 2px 10px rgb(0 0 0 / 20%);\" rounded>\r\n            <div class=\"header-title\" slot=\"title\">\r\n              <el-button v-prevent-re-click icon=\"el-icon-upload2\" size=\"mini\" type=\"primary\" @click=\"doExport\">导出\r\n              </el-button>\r\n            </div>\r\n            <template slot=\"options\">\r\n              <div class=\"options-content\">\r\n                <el-form @submit.native.prevent :model=\"wsForm\" label-position=\"right\" label-width=\"82px\">\r\n                  <ef-text label=\"编码\" v-model=\"wsForm.med_list_codg\" name=\"med_list_codg\"\r\n                           placeholder=\"请输入机构编码/市码/省码/国码/自定义码\" style=\"width: 350px\"/>\r\n                  <ef-text label-width=\"60px\" label=\"药品名称\" v-model=\"wsForm.drug_name\" name=\"drug_name\"\r\n                           placeholder=\"药品注册名/商品名/通用名\"/>\r\n                </el-form>\r\n                <el-button v-prevent-re-click icon=\"el-icon-search\" size=\"mini\" type=\"primary\"\r\n                           @click=\"searchInvalidMed()\" style=\"margin-left:6px;\">国家作废西药查询\r\n                </el-button>\r\n                <el-button-group style=\"margin: 0 5px\">\r\n                  <el-button v-prevent-re-click icon=\"el-icon-search\" type=\"info\" plain size=\"mini\"\r\n                             @click=\"loadMedList1\"></el-button>\r\n                  <el-button v-prevent-re-click icon=\"el-icon-refresh\" type=\"info\" plain size=\"mini\"\r\n                             @click=\"resetMedList1\"></el-button>\r\n                  <el-popover\r\n                      placement=\"bottom\"\r\n                      popper-class=\"popover-content\"\r\n                      width=\"800\"\r\n                      v-model=\"visable1\"\r\n                      trigger=\"click\">\r\n                    <!--      更多筛选-->\r\n                    <div>\r\n                      <el-form @submit.native.prevent :model=\"wsForm\" label-position=\"right\" label-width=\"82px\">\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"助记码\" v-model=\"wsForm.pinyin\" name=\"pinyin\" placeholder=\"请输入拼音码\\五笔码\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"生产企业名称\" v-model=\"wsForm.prodentp_name\" name=\"prodentp_name\"\r\n                                     placeholder=\"请输入生产企业名称\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"医保属性\" name=\"type\" v-model=\"wsForm.type\"\r\n                                       dictionaryNo=\"DIC_MEDICAL_INSURANCE\" placeholder=\"请选择医保属性\"/>\r\n                          </el-col>\r\n\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"目录类别\" name=\"test\" v-model=\"wsForm.list_type\" placeholder=\"请选择目录类别\"\r\n                                       dictionaryNo=\"DIC_LIST_TYPE\" dictionaryGroup=\"1\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"药品规格\" v-model=\"wsForm.spec\" name=\"spec\" placeholder=\"请输入药品规格\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"药品剂型\" name=\"dosformCode\" v-model=\"wsForm.dosformCode\"\r\n                                       dictionaryNo=\"DIC_DRUG_DOSFORM\" filterable=\"true\" placeholder=\"请选择药品剂型\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"有效标志\" name=\"valid\" v-model=\"wsForm.valid\"\r\n                                       dictionaryNo=\"DIC_VALI_FLAG\" filterable=\"true\" placeholder=\"有效标志\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <div class=\"more-button\">\r\n                              <el-button v-prevent-re-click icon=\"el-icon-s-open\" size=\"mini\" type=\"primary\"\r\n                                         @click=\"loadMedList1\">筛选\r\n                              </el-button>\r\n                              <el-button v-prevent-re-click icon=\"el-icon-refresh\" size=\"mini\" type=\"primary\" plain\r\n                                         @click=\"resetMedList1\">\r\n                                重置\r\n                              </el-button>\r\n                            </div>\r\n                          </el-col>\r\n                        </el-row>\r\n                      </el-form>\r\n                    </div>\r\n                    <el-button v-prevent-re-click slot=\"reference\" icon=\"el-icon-s-open\" size=\"mini\" type=\"info\" plain>\r\n                      更多筛选\r\n                    </el-button>\r\n                  </el-popover>\r\n                </el-button-group>\r\n              </div>\r\n            </template>\r\n            <div style=\"height: 100%\">\r\n              <ef-page-grid ref=\"medListCrspMgrGrid\" queryNo=\"Q_MedListCrspMgr_005\" pageSize=\"20\" queryWindow=\"1\"\r\n                            style=\"height: 100%\"/>\r\n            </div>\r\n          </base-block>\r\n        </div>\r\n        <div style=\"height: 100%;\" v-show=\"selectTab == 1\">\r\n          <base-block style=\"height: 100%;box-shadow: 0 2px 10px rgb(0 0 0 / 20%);\" rounded>\r\n            <div class=\"header-title\" slot=\"title\">\r\n              <el-button-group>\r\n                <el-button v-prevent-re-click icon=\"el-icon-upload2\" size=\"mini\" type=\"primary\" @click=\"doExport\">导出\r\n                </el-button>\r\n              </el-button-group>\r\n            </div>\r\n            <template slot=\"options\">\r\n              <div class=\"options-content\">\r\n                <el-form @submit.native.prevent :model=\"tcForm\" label-position=\"right\" label-width=\"82px\">\r\n                  <ef-text label=\"编码\" v-model=\"tcForm.med_list_codg\" name=\"med_list_codg\"\r\n                           placeholder=\"请输入机构编码/市码/省码/国码/自定义码\" style=\"width: 350px\"/>\r\n                  <ef-text style=\"width: 200px\" label-width=\"60px\" label=\"药品名称\" v-model=\"tcForm.drug_name\"\r\n                           name=\"drug_name\" placeholder=\"中草药名称/药材名称\"/>\r\n                </el-form>\r\n                <el-button v-prevent-re-click icon=\"el-icon-search\" size=\"mini\" type=\"primary\"\r\n                           @click=\"searchInvalidMed()\" style=\"margin-left:6px;\">国家作废中药查询\r\n                </el-button>\r\n                <el-button-group style=\"margin: 0 5px\">\r\n                  <el-button v-prevent-re-click icon=\"el-icon-search\" type=\"info\" plain size=\"mini\"\r\n                             @click=\"loadMedList2\"></el-button>\r\n                  <el-button v-prevent-re-click icon=\"el-icon-refresh\" type=\"info\" plain size=\"mini\"\r\n                             @click=\"resetMedList2\"></el-button>\r\n                  <el-popover\r\n                      placement=\"bottom\"\r\n                      popper-class=\"popover-content\"\r\n                      width=\"800\"\r\n                      v-model=\"visable2\"\r\n                      trigger=\"click\">\r\n                    <!--      更多筛选-->\r\n                    <div>\r\n                      <el-form @submit.native.prevent :model=\"wsForm\" label-position=\"right\" label-width=\"82px\">\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"中草药年份\" :numberFlag=\"true\" v-model=\"tcForm.tcmherb_year\" name=\"tcmherb_year\"\r\n                                     placeholder=\"请输入中草药年份\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"单复方标志\" name=\"cpnd_flag\" v-model=\"tcForm.cpnd_flag\"\r\n                                       dictionaryNo=\"DIC_TCMDRUG_USED_WAY\" placeholder=\"请选择单复方标志\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"医保属性\" name=\"type\" v-model=\"tcForm.type\"\r\n                                       dictionaryNo=\"DIC_MEDICAL_INSURANCE\"\r\n                                       placeholder=\"请选择医保属性\"/>\r\n                          </el-col>\r\n\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"功效分类\" v-model=\"tcForm.ecy_type\" name=\"ecy_type\" placeholder=\"请输入功效分类\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"功能主治\" v-model=\"tcForm.efcc_atd\" name=\"efcc_atd\" placeholder=\"请输入功能主治\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"生产企业名称\" v-model=\"tcForm.prodentp_name\" name=\"prodentp_name\"\r\n                                     placeholder=\"请输入生产企业名称\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"产地\" v-model=\"tcForm.exct_cont\" name=\"exct_cont\" placeholder=\"请输入产地\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"药品剂型\" name=\"dosformCode\" v-model=\"tcForm.dosformCode\"\r\n                                       dictionaryNo=\"DIC_DRUG_DOSFORM\"\r\n                                       filterable=\"true\" @onChange=\"tcDosformChange\" placeholder=\"请选择药品剂型\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <el-row :gutter=\"20\">\r\n                          <el-col :span=\"12\">\r\n                            <ef-text label=\"规格\" v-model=\"tcForm.spec\" name=\"spec\" placeholder=\"请输入规格\"/>\r\n                          </el-col>\r\n                          <el-col :span=\"12\">\r\n                            <ef-select label=\"有效标志\" name=\"valid2\" v-model=\"tcForm.valid\"\r\n                                       dictionaryNo=\"DIC_VALI_FLAG\"\r\n                                       filterable=\"true\" placeholder=\"有效标志\"/>\r\n                          </el-col>\r\n                        </el-row>\r\n                        <div class=\"more-button\">\r\n                          <el-button v-prevent-re-click icon=\"el-icon-s-open\" size=\"mini\" type=\"primary\"\r\n                                     @click=\"loadMedList2\">筛选\r\n                          </el-button>\r\n                          <el-button v-prevent-re-click icon=\"el-icon-refresh\" size=\"mini\" type=\"primary\" plain\r\n                                     @click=\"resetMedList2\">重置\r\n                          </el-button>\r\n                        </div>\r\n                      </el-form>\r\n                    </div>\r\n                    <el-button v-prevent-re-click slot=\"reference\" icon=\"el-icon-s-open\" size=\"mini\" type=\"info\" plain>\r\n                      更多筛选\r\n                    </el-button>\r\n                  </el-popover>\r\n                </el-button-group>\r\n              </div>\r\n            </template>\r\n            <div style=\"height: 100%\">\r\n              <ef-page-grid ref=\"medListCrspMgr103Grid\" queryNo=\"Q_MedListCrspMgr103_006\" pageSize=\"20\"\r\n                            queryWindow=\"1\" style=\"height: 100%\"/>\r\n            </div>\r\n          </base-block>\r\n        </div>\r\n      </div>\r\n    </el-main>\r\n  </el-container>\r\n</template>\r\n\r\n<script>\r\nimport {BaseCtrl} from '/src/util/eframe'\r\nimport {mapGetters} from \"vuex\";\r\nimport constData from \"../../../../const\";\r\n\r\nexport default {\r\n  name: \"grid9\",\r\n  mixins: [BaseCtrl],\r\n  data() {\r\n    return {\r\n      dialogTableVisible:false,\r\n      visable1: false,\r\n      visable2: false,\r\n      selectTab: 0,\r\n      fixmedins_id: '',\r\n      //中西药查询\r\n      wsForm: {\r\n        med_list_codg: '',//医疗目录编号\r\n        fixmedins_hilist_id: '',//自定义编码\r\n        drug_name: '',//药品名\r\n        pinyin: '',//助记码\r\n        prodentp_name: '',//生产企业名称\r\n        type: '',//医保属性\r\n        spec: '',//药品规格\r\n        list_type: '',//目录类别\r\n        dosformCode: '', //药品剂型\r\n        chk_stas: '', //审核状态\r\n        valid: '1', //有效标志\r\n      },\r\n      //中药饮片查询\r\n      tcForm: {\r\n        dosform: '',\r\n        prodentp_name: '',\r\n        exct_cont: '',\r\n        spec: '',\r\n        med_list_codg: '',//医疗目录编号\r\n        fixmedins_hilist_id: '',//自定义编码\r\n        drug_name: '',//药品名称\r\n        type: '',//医保属性\r\n        // pinyin: '',//拼音助记码\r\n        // wubi: '',//五笔助记码\r\n        tcmherb_year: '',//中草药年份\r\n        cpnd_flag: '',//单复方标志\r\n        ecy_type: '',//功效分类\r\n        efcc_atd: '',//功能主治\r\n        chk_stas: '', //审核状态\r\n        valid: '1', //有效标志\r\n      },\r\n      accept: \"xls,xlsx\",\r\n    }\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    this.visable1 = false\r\n    this.visable2 = false\r\n    next()\r\n  },\r\n  created() {\r\n    let that = this;\r\n    this.loadDicItem({dicId: \"DIC_DRUG_DOSFORM\"});//药品剂型字典\r\n    this.fixmedins_id = that.userInfo.fixmedins_id;\r\n    this.$nextTick(() => {\r\n      //中西药\r\n      this.$refs['medListCrspMgrGrid'].setInitFun((grid) => {//扩展Grid函数\r\n        let options = grid.getOptions();\r\n\r\n        options.dataBound = function () {\r\n          let row = grid.dataSource.data();\r\n          for (let i = 0; i < row.length; i++) {\r\n            let uid = row[i].uid;\r\n            let invalid = row[i].INVALID;\r\n            if (invalid == \"1\") {\r\n              $(\"tbody\").find(\"tr[data-uid=\" + uid + \"]\").css(\"color\", \"red\")\r\n            }\r\n          }\r\n        };\r\n\r\n        let columns = options.columns;\r\n        columns.unshift({\r\n          title: \"操作\",\r\n          width: 62,\r\n          locked:true,\r\n          command: [\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn01\",\r\n              template: \"<a class='k-button k-grid-btn01'>修改</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '1') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail(rowData);\r\n                }\r\n              }\r\n            },\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn02\",\r\n              template: \"<a class='k-button k-grid-btn02'>查看</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '0') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail(rowData);\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        grid.setOptions(options);\r\n        that.loadMedList1();\r\n      });\r\n\r\n      //中药饮片\r\n      this.$refs['medListCrspMgr103Grid'].setInitFun((grid) => {//扩展Grid函数\r\n        let options = grid.getOptions();\r\n\r\n        options.dataBound = function () {\r\n          let row = grid.dataSource.data();\r\n          for (let i = 0; i < row.length; i++) {\r\n            let uid = row[i].uid;\r\n            let invalid = row[i].INVALID;\r\n            if (invalid == \"1\") {\r\n              $(\"tbody\").find(\"tr[data-uid=\" + uid + \"]\").css(\"color\", \"red\")\r\n            }\r\n          }\r\n        };\r\n\r\n        let columns = options.columns;\r\n        columns.unshift({\r\n          title: \"操作\",\r\n          width: 62,\r\n          command: [\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn01\",\r\n              template: \"<a class='k-button k-grid-btn01'>修改</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '1') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail103(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail103(rowData);\r\n                }\r\n              }\r\n            },\r\n            {\r\n              className: \"btn btn-xs btn-default\",\r\n              name: \"btn02\",\r\n              template: \"<a class='k-button k-grid-btn02'>查看</a>\",\r\n              visible: function (dataItem) {\r\n                if (dataItem.get(\"VALI_FLAG\") == '0') {\r\n                  return true;\r\n                }\r\n              },\r\n              click: function (e) {\r\n                let tr = $(e.target).closest(\"tr\");\r\n                let rowData = grid.dataItem(tr);\r\n                if (that.isNull(rowData.get(\"CITY_CODE\"))) {\r\n                  that.openMedlistcrspmgrowndetail103(rowData);\r\n                } else {\r\n                  that.openMedlistcrspmgrdetail103(rowData);\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        });\r\n        grid.setOptions(options);\r\n        that.loadMedList2();\r\n      });\r\n    });\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"userInfo\"])\r\n  },\r\n  mounted() {\r\n  },\r\n  methods: {\r\n    //查找国家库中作废的对照\r\n    searchInvalidMed() {\r\n      let whereCondition = \" invalid='1' \";\r\n      let grid = \"medListCrspMgrGrid\";\r\n      if (this.selectTab == 1) {\r\n        this.resetMedList2();\r\n        grid = \"medListCrspMgr103Grid\";\r\n      } else {\r\n        this.resetMedList1();\r\n      }\r\n      this.$refs[grid].getWidget().doRefresh({\r\n        whereCondition: whereCondition,\r\n        parameters: {fixmedins_id: this.fixmedins_id}\r\n      });\r\n    },\r\n\r\n    //药品剂型改变时\r\n    tcDosformChange(val) {\r\n      if (val) {\r\n        //取剂型名称\r\n        this.tcForm.dosform = this.selectDicItem('DIC_DRUG_DOSFORM', val);\r\n      } else {\r\n        this.tcForm.dosform = \"\";\r\n      }\r\n    },\r\n\r\n    changeSelectTab(num) {\r\n      //清空搜索条件\r\n      this.wsForm.dosformCode = \"\";\r\n      this.selectTab = num;\r\n    },\r\n    //打开自费西药页面\r\n    openMedlistcrspmgrowndetail(item) {\r\n      let that = this;\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgrGrid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      that.slideReveal({\r\n        title: \"自费药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrowndetail\",\r\n        width: 1000,\r\n        params: {\r\n          medins_medlist_id: item.get(\"MEDINS_MEDLIST_ID\"),//药品内码\r\n          list_type: item.get(\"LIST_TYPE\")//目录类别\r\n        },\r\n        callBackFun: backFun\r\n      });\r\n\r\n    },\r\n    //打开医保西药页面\r\n    openMedlistcrspmgrdetail(item) {\r\n      let that = this;\r\n      let flag = false;\r\n      let invalid = item.get(\"INVALID\");\r\n      if (invalid == \"1\") {//医保无效——本机构作废\r\n        flag = true;\r\n      }\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgrGrid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      that.slideReveal({\r\n        title: \"医保药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrdetail\",\r\n        width: 1000,\r\n        params: {\r\n          med_list_codg: item.get(\"MED_LIST_CODG\"),//医疗目录编码\r\n          list_type: item.get(\"LIST_TYPE\"),\r\n          medins_medlist_id: item.get(\"MEDINS_MEDLIST_ID\"),//药品内码\r\n          vali_flag: item.get(\"VALI_FLAG\"),//药品无效\r\n          city_code: item.get(\"CITY_CODE\"),//市码\r\n          prov_code: item.get(\"PROV_CODE\"),//省码\r\n          flag: flag\r\n        },\r\n        callBackFun: backFun\r\n      });\r\n    },\r\n\r\n    //打开自费中药饮片页面\r\n    openMedlistcrspmgrowndetail103(item) {\r\n      let that = this;\r\n      let medins_medlist_id = item.get(\"MEDINS_MEDLIST_ID\");//药品内码\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgr103Grid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      that.slideReveal({\r\n        title: \"自费药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrowndetail103\",\r\n        width: 1000,\r\n        params: {medins_medlist_id: medins_medlist_id},\r\n        callBackFun: backFun\r\n      });\r\n    },\r\n    //打开医保中药饮片页面\r\n    openMedlistcrspmgrdetail103(item) {\r\n      let that = this;\r\n      let flag = false;\r\n      let invalid = item.get(\"INVALID\");\r\n      if (invalid == \"1\") {//医保无效——本机构作废\r\n        flag = true;\r\n      }\r\n      let backFun = function (data) {\r\n        that.$refs['medListCrspMgr103Grid'].getWidget().doRefresh(); //刷新Grid\r\n      }\r\n      console.log(item);\r\n      that.slideReveal({\r\n        title: \"医保药详情\",\r\n        view: \"/views/ehis/medlistmgmt/medlistcrspmgr/medlistcrspmgrdetail103\",\r\n        width: 1000,\r\n        params: {\r\n          med_list_codg: item.get(\"MED_LIST_CODG\"),//医疗目录编码\r\n          medins_medlist_id: item.get(\"MEDINS_MEDLIST_ID\"),//药品内码\r\n          vali_flag: item.get(\"VALI_FLAG\"),//药品无效\r\n          city_code: item.get(\"CITY_CODE\"),//市码\r\n          prov_code: item.get(\"PROV_CODE\"),//省码\r\n          flag: flag\r\n        },\r\n        callBackFun: backFun\r\n      });\r\n    },\r\n    loadMedList1() {\r\n      let whereCondition = \"1=1\";\r\n      if (this.wsForm.med_list_codg) {\r\n        whereCondition += \" and (lower(med_list_codg) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(fixmedins_hilist_id) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(city_code) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(fix_asit_code) like lower('%\" + this.wsForm.med_list_codg +\r\n            \"%') or lower(prov_code) like lower('%\" + this.wsForm.med_list_codg + \"%'))\";\r\n      }\r\n      if (this.wsForm.commodity_name) {\r\n        whereCondition += \"and commodity_name like '%\" + this.wsForm.commodity_name + \"%'\";\r\n      }\r\n      if (this.wsForm.drug_name) {\r\n        whereCondition += \"and (fixmedins_hilist_name like '%\" + this.wsForm.drug_name + \"%'\" +\r\n            \" OR drug_genname like '%\" + this.wsForm.drug_name + \"%'\" +\r\n            \" OR commodity_name like '%\" + this.wsForm.drug_name + \"%')\";\r\n      }\r\n      if (this.wsForm.pinyin) {\r\n        whereCondition += \" and (lower(pinyin) like lower('%\" + this.wsForm.pinyin + \"%')\" +\r\n            \" or lower(wubi) like lower('%\" + this.wsForm.pinyin + \"%'))\";\r\n      }\r\n      if (this.wsForm.prodentp_name) {\r\n        whereCondition += \" and prodentp_name like '%\" + this.wsForm.prodentp_name + \"%'\";\r\n      }\r\n      if (this.wsForm.type && this.wsForm.type !== '2') {\r\n        whereCondition += \" and type = '\" + this.wsForm.type + \"'\";\r\n      }\r\n      if (this.wsForm.spec) {\r\n        whereCondition += \" and spec like '%\" + this.wsForm.spec + \"%'\";\r\n      }\r\n      if (this.wsForm.list_type) {\r\n        whereCondition += \" and list_type = '\" + this.wsForm.list_type + \"'\";\r\n      }\r\n      if (this.wsForm.dosformCode) {\r\n        let drug_dosform = this.selectDicItem('DIC_DRUG_DOSFORM', this.wsForm.dosformCode);\r\n        if (this.isNotNull(drug_dosform)) {\r\n          whereCondition += \" and dosform = '\" + drug_dosform + \"'\";\r\n        }\r\n      }\r\n      if (this.wsForm.chk_stas) {\r\n        whereCondition += \" and CHK_STAS = '\" + this.wsForm.chk_stas + \"'\";\r\n      }\r\n      if (this.wsForm.valid) {\r\n        whereCondition += \" and VALI_FLAG = '\" + this.wsForm.valid + \"'\";\r\n      }\r\n      this.$refs['medListCrspMgrGrid'].getWidget().doRefresh({\r\n        whereCondition: whereCondition,\r\n        parameters: {fixmedins_id: this.fixmedins_id}\r\n      });\r\n    },\r\n    resetMedList1() {\r\n      this.wsForm.med_list_codg = '';\r\n      this.wsForm.fixmedins_hilist_id = '';\r\n      this.wsForm.pinyin = '';\r\n      this.wsForm.drug_name = '';\r\n      this.wsForm.prodentp_name = '';\r\n      this.wsForm.type = '';\r\n      this.wsForm.spec = '';\r\n      this.wsForm.list_type = '';\r\n      this.wsForm.dosformCode = '';\r\n      this.wsForm.chk_stas = '';\r\n      this.wsForm.valid = '1';\r\n    },\r\n    loadMedList2() {\r\n      let whereCondition = \"1=1\";\r\n      if (this.tcForm.type && this.tcForm.type !== '2') {\r\n        whereCondition += \" and type = '\" + this.tcForm.type + \"'\";\r\n      }\r\n      if (this.tcForm.med_list_codg) {\r\n        whereCondition += \" and (lower(med_list_codg) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(fixmedins_hilist_id) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(city_code) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(fix_asit_code) like lower('%\" + this.tcForm.med_list_codg +\r\n            \"%') or lower(prov_code) like lower('%\" + this.tcForm.med_list_codg + \"%'))\";\r\n      }\r\n      if (this.tcForm.prodentp_name) {\r\n        whereCondition += \" and prodentp_name like '%\" + this.tcForm.prodentp_name + \"%'\";\r\n      }\r\n      if (this.tcForm.exct_cont) {\r\n        whereCondition += \" and exct_cont like '%\" + this.tcForm.exct_cont + \"%'\";\r\n      }\r\n      if (this.tcForm.spec) {\r\n        whereCondition += \" and spec like '%\" + this.tcForm.spec + \"%'\";\r\n      }\r\n      if (this.tcForm.dosform) {\r\n        whereCondition += \" and dosform = '\" + this.tcForm.dosform + \"'\";\r\n      }\r\n      if (this.tcForm.drug_name) {\r\n        whereCondition += \"and (fixmedins_hilist_name like '%\" + this.tcForm.drug_name + \"%'\" +\r\n            \" or commodity_name like '%\" + this.tcForm.drug_name + \"%')\";\r\n      }\r\n      if (this.tcForm.tcmherb_year) {\r\n        whereCondition += \" and tcmherb_year = '\" + this.tcForm.tcmherb_year + \"'\";\r\n      }\r\n      if (this.tcForm.cpnd_flag) {\r\n        whereCondition += \" and cpnd_flag = '\" + this.tcForm.cpnd_flag + \"'\";\r\n      }\r\n      if (this.tcForm.ecy_type) {\r\n        whereCondition += \" and ecy_type like '%\" + this.tcForm.ecy_type + \"%'\";\r\n      }\r\n      if (this.tcForm.efcc_atd) {\r\n        whereCondition += \" and efcc_atd like '%\" + this.tcForm.efcc_atd + \"%'\";\r\n      }\r\n      if (this.tcForm.chk_stas) {\r\n        whereCondition += \" and CHK_STAS = '\" + this.tcForm.chk_stas + \"'\";\r\n      }\r\n      if (this.tcForm.valid) {\r\n        whereCondition += \" and VALI_FLAG = '\" + this.tcForm.valid + \"'\";\r\n      }\r\n\r\n      this.$refs['medListCrspMgr103Grid'].getWidget().doRefresh({\r\n        whereCondition: whereCondition,\r\n        parameters: {fixmedins_id: this.fixmedins_id}\r\n      });\r\n    },\r\n    resetMedList2() {\r\n      this.tcForm.type = '';\r\n      this.tcForm.med_list_codg = '';\r\n      this.tcForm.fixmedins_hilist_id = '';\r\n      this.tcForm.drug_name = '';\r\n      this.tcForm.tcmherb_year = '';\r\n      this.tcForm.cpnd_flag = '';\r\n      this.tcForm.ecy_type = '';\r\n      this.tcForm.efcc_atd = '';\r\n      this.tcForm.dosformCode = '';\r\n      this.tcForm.dosform = '';\r\n      this.tcForm.prodentp_name = '';\r\n      this.tcForm.exct_cont = '';\r\n      this.tcForm.spec = '';\r\n      this.tcForm.chk_stas = '';\r\n      this.tcForm.valid = '1';\r\n    },\r\n\r\n    doExport() {\r\n      let that = this;\r\n      let okFun = function () {\r\n        if (that.selectTab === 0) {\r\n          that.exportFileByWidget({\r\n            widget: that.$refs['medListCrspMgrGrid'].getWidget(),\r\n            expType: \"all\",\r\n            fileType: \"excel\"\r\n          });\r\n        } else {\r\n          that.exportFileByWidget({\r\n            widget: that.$refs['medListCrspMgr103Grid'].getWidget(),\r\n            expType: \"all\",\r\n            fileType: \"excel\"\r\n          });\r\n        }\r\n      };\r\n      this.confirm(\"提示\", \"确定要导出查询出的药品信息吗？\", okFun, null);\r\n    },\r\n    importFile1(file) {\r\n      let that = this;\r\n      let name = file.name;\r\n      var form = {\r\n        file: file,\r\n      };\r\n      var callBackFun = function (data) {\r\n        if (data != null) {\r\n          if (isNotNull(data.error)) {\r\n            that.$eframe.alertMessage(\"导入失败：\" + data.error);\r\n            return;\r\n          }\r\n          if (isNotNull(data.errorCount) && data.errorCount > 0) {\r\n            window.location.href = constData.baseUrl + \"/download/\" + data.excelName;\r\n            that.$eframe.alertMessage(data.info + \"详细参考：\" + data.excelName);\r\n          } else {\r\n            that.$eframe.alertMessage(\"您本次成功导入\" + data.successCount + \"条记录\");\r\n          }\r\n        }\r\n        that.loadMedList1();\r\n      };\r\n      this.$eframe.submitTargetFileForm({\r\n        url: \"/ehis/medlistmgmt/medlist.action\",\r\n        form: form,\r\n        actionFunName: \"impMedListData\",\r\n        succFun: callBackFun,\r\n        files: file\r\n      });\r\n    },\r\n    importFile2(file) {\r\n      let that = this;\r\n      let name = file.name;\r\n      var form = {\r\n        file: file,\r\n      };\r\n      var callBackFun = function (data) {\r\n        if (data != null) {\r\n          if (isNotNull(data.error)) {\r\n            that.$eframe.alertMessage(\"导入失败：\" + data.error);\r\n            return;\r\n          }\r\n          if (isNotNull(data.errorCount) && data.errorCount > 0) {\r\n            window.location.href = constData.baseUrl + \"/download/\" + data.excelName;\r\n            that.$eframe.alertMessage(data.info + \"详细参考：\" + data.excelName);\r\n          } else {\r\n            that.$eframe.alertMessage(\"您本次成功导入\" + data.successCount + \"条记录\");\r\n          }\r\n        }\r\n        that.loadMedList2();\r\n      };\r\n      this.$eframe.submitTargetFileForm({\r\n        url: \"/ehis/medlistmgmt/medlist.action\",\r\n        form: form,\r\n        actionFunName: \"impHerbListData\",\r\n        succFun: callBackFun,\r\n        files: file\r\n      });\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n::v-deep .block-content {\r\n  height: calc(100% - 37px);\r\n}\r\n</style>"]}]}