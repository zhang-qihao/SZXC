import { FIELD_REGEX } from './constants';

const getterCache = {};

(getterCache as any).undefined = () => undefined;

/**
 * @hidden
 */
export function getter(field: string): any {
    if (getterCache[field]) {
        return getterCache[field];
    }

    const fields: any[] = [];
    field.replace(FIELD_REGEX, function (_match: string, index: string, indexAccessor: string, fieldName: string): any {
        fields.push(index !== undefined ? index : (indexAccessor || fieldName));
    });

    getterCache[field] = function (obj: any): any {
        let result = obj;
        for (let idx = 0; idx < fields.length && result; idx++) {
            result = result[fields[idx]];
        }

        return result;
    };

    return getterCache[field];
}
